# Ty's Online Chatting Room

## 一、立项

本项目为2017年程序设计大作业，意在使用pyQt5实现一个简单的在线聊天室

### 开发环境要求



pyQt+python3.5+sqlite3

硬件方面：阿里云 CentOs7+1核+内存2G（阿里云学生机）

###开发前的目标

该部分的具体设想写于2017年11月23日，在后期开发过程中可能会修改我们的目标，在最后会有一个达成情况的陈列。

我们希望能够完成的目标：

1. 实现一个用户类，包含用户的相关信息，储存在服务器的数据库当中，用户拥有的功能有：登陆、修改部分个人信息（能修改一个，则其他的都能修改，为节约时间仅表现可实现性）。
2. 实现一个用户**在线聊天功能**和一个**公共文件上传功能**，聊天记录和文件在服务器可以进行储存
3. 使用pyQt designer设计好用户界面

## 二、开发日志

#### 11月25日

搭建环境，测试pyQt的基本功能，测试python中需要用的到的sqlite3，struct，pickle库，整个业务逻辑基本如下：

​	![business](business.jpg)

具体阐述下其中几个关键的部分：

1. packages设定。

   由于TCP协议接受发送信息必须是二进制的，但是python本来是排斥二进制的，并且TCP服务器和客户端接受信息都是每一次达到最大值之后再返回，基于这个点，我们对于package的要求要更高，经过多次探索和百度，我们找到了正确的方法，使用strut+pickle，我们的包有一下固定的格式：

   - 一个数字，由struct生成，用于表示指令
   - 一个数字，由struct生成，用于表示结构体长度
   - 一个结构体，用于进行操作，有pickle产生

2. 服务器的业务逻辑

   我们的服务器段有一个字典，专门存放指针函数，用于处理业务逻辑，在用户发包时，先处理前四个字节，得到具体的指令，利用该business字典调用具体的函数进行第二个部分的数据读取，对结构体进行操作。

在11月26日主要进行的是聊天界面的搭建（涉及一些pyQt的技术）和服务器业务逻辑方面的源码积累。

#### 11月26日

今天实现了登陆功能，进入到了聊天室界面的设计

聊天室界面在不断的探索之后主体还是用QTextbrowser实时显示，（我们应当会增加一个发送图片的功能），但这会改动我之前粗糙的聊天室ui界面，这部分的代码可能需要移植，将该任务暂时挂起，待其他的部分都完善好了之后再进行页面的设计。

对我们的服务器端和客户端进行了一些封装，代码可读性大大提高。

我们的项目使用简单的轮询机制来获得信息，我们的信息会暂时存在一个list中，利用轮训机制最终本地服务器得到我们的数据，我们要查看消息记录的话，只需要访问本地的消息记录就好（当然可能实现不了你在查询记录的时候发送过来几条的实时更新）

现在就怕这我的服务器不能承载这一切。

我们的文件上传下载的功能的基本知识已经习得 

